import{r as e,j as r,c as t}from"./vendor-36ba57f3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)})).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?r.credentials="include":"anonymous"===e.crossOrigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();const a=e=>{let r=e;const t=new Set;return{subscribe:e=>(t.add(e),()=>{t.delete(e)}),setData:e=>{r="function"==typeof e?e(r):e,t.forEach((e=>{e(r)}))},getValue:()=>r}},n=a(new Array(3).fill(new Array(16).fill(!1))),o=(e,r)=>{n.setData((t=>t.map(((t,a)=>t.map(((t,n)=>a===e&&n===r?!t:t))))))},s=()=>{n.setData((e=>e.map((e=>e.map((()=>!1))))))},l=a(new AudioContext),c=[{title:"Hi-hat",fileName:"hh"},{title:"Snare",fileName:"sd"},{title:"Kick",fileName:"kd"}],i=((e,r)=>{let t={isLoading:!1,isError:!1,data:r??null,error:null};const a=new Set;return{startChange:(...e)=>{t={...t,isLoading:!0,isError:!1,error:null},a.forEach((e=>{e(t)})),(async()=>Promise.all(c.map((({title:e,fileName:r})=>async function(e,r){const t=await fetch(`./${e}`),a=await t.arrayBuffer();return{name:r,audioBuffer:await l.getValue().decodeAudioData(a)}}(`sounds/pack1/${r}.wav`,e)))))(...e).then((e=>{t={isLoading:!1,isError:!1,error:null,data:e},a.forEach((e=>{e(t)}))})).catch((e=>{t={error:e,isError:!0,isLoading:!1,data:r},a.forEach((e=>{e(t)}))}))},subscribe:e=>(a.add(e),()=>{a.delete(e)}),setData:e=>{t=e,a.forEach((e=>{e(t)}))},getValue:()=>t}})(0,[]),d=r=>e.useSyncExternalStore(r.subscribe,r.getValue),u=a({rowIndex:0,colIndex:0}),f=(e,r)=>{u.setData({rowIndex:e,colIndex:r})},m=a(0),h=()=>{m.setData((e=>e+1))},g=(e=>{let r=!1;const t=new Set;return{subscribe:e=>(t.add(e),()=>{t.delete(e)}),on:()=>{r=!0,t.forEach((e=>{e(r)}))},off:()=>{r=!1,t.forEach((e=>{e(r)}))},toggle:()=>{r=!r,t.forEach((e=>{e(r)}))},getValue:()=>r}})(),b=r=>e.useSyncExternalStore(r.subscribe,r.getValue),v=()=>{const e=d(n),t=d(u),a=b(g),s=d(m);return r.jsx("div",{onKeyDown:e=>{(e=>{var r,t,a,s;const{rowIndex:l,colIndex:c}=u.getValue(),i=n.getValue();switch(e){case"Enter":o(l,c);break;case"ArrowLeft":void 0!==(null==(r=i[l])?void 0:r[c-1])&&f(l,c-1);break;case"ArrowDown":void 0!==(null==(t=i[l+1])?void 0:t[c])&&f(l+1,c);break;case"ArrowRight":void 0!==(null==(a=i[l])?void 0:a[c+1])&&f(l,c+1);break;case"ArrowUp":void 0!==(null==(s=i[l-1])?void 0:s[c])&&f(l-1,c)}})(e.code)},children:e.map(((n,l)=>r.jsx("div",{className:"flex gap-1 outline-none",tabIndex:1,children:n.map(((n,c)=>r.jsx("div",{onClick:()=>{var e,r;o(e=l,r=c),f(e,r)},className:`mb-1 w-12 h-8 cursor-pointer ${t.rowIndex===l&&t.colIndex===c?"border-4 border-violet-400":""} ${n?"bg-blue-700":c%4==0?"bg-blue-200":"bg-blue-100"} ${a&&s%e[0].length===c?"opacity-50":""}`},`${l}-${c}`)))},l)))})},p=a({bpm:120,ms:125});let x=null;const w=()=>{const e=i.getValue().data,r=m.getValue(),t=n.getValue();t.forEach(((a,n)=>{a.forEach(((a,o)=>{a&&r%t[0].length===o&&e&&(e=>{const r=l.getValue(),t=r.createBufferSource();t.buffer=e;const a=r.createGain();t.connect(a),a.connect(r.destination),t.playbackRate.value=4,t.start()})(e[n].audioBuffer)}))}))},y=()=>{g.on(),x=setInterval((()=>{w(),h()}),p.getValue().ms)},E=()=>{g.off(),clearInterval(x),m.setData(0),x=null};let j=Date.now();const I=()=>{const e=Date.now();var r;r=e-j,p.setData({bpm:Math.floor(6e4/r),ms:Math.floor(r/4)}),j=e,g.getValue()&&(clearInterval(x),x=setInterval((()=>{w(),h()}),p.getValue().ms))};p.subscribe((e=>{g.getValue()&&(clearInterval(x),x=setInterval((()=>{w(),h()}),e.ms))}));const V=()=>{const e=b(g),t=d(m);return r.jsxs("button",{className:"border p-3 rounded",onClick:e?E:y,children:[e?"Stop":"Play"," - ",t]})},k=()=>{const e=d(p).bpm;return r.jsxs("div",{className:"flex",children:[r.jsx("input",{type:"number",value:e,onChange:e=>{var r;r=+e.target.value,p.setData({bpm:r,ms:Math.floor(15e3/r)})}}),r.jsx("button",{onClick:I,children:"TAP"})]})};t.createRoot(document.getElementById("root")).render(r.jsx((()=>{const t=(c=i,e.useSyncExternalStore(c.subscribe,c.getValue)),{data:a,isLoading:n,isError:o,error:l}=t;var c;return e.useEffect((()=>{i.startChange()}),[]),n?r.jsx("h1",{children:"Loading"}):o?r.jsx("h1",{children:"Error"}):r.jsxs("div",{className:"",children:[r.jsx(k,{}),r.jsx("button",{onClick:s,children:"Clear"}),r.jsx(V,{}),r.jsxs("div",{className:"flex g-2",children:[r.jsx("div",{children:null==a?void 0:a.map((e=>r.jsx("div",{className:"mb-1 w-20 h-8",children:e.name},e.name)))}),r.jsx(v,{})]})]})}),{}));
//# sourceMappingURL=index-e7df0786.js.map
