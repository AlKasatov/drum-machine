import{r as e,j as t,c as r}from"./vendor-36ba57f3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const a=e=>{let t=e;const r=new Set;return{subscribe:e=>(r.add(e),()=>{r.delete(e)}),setData:e=>{t="function"==typeof e?e(t):e,r.forEach((e=>{e(t)}))},getValue:()=>t}},n=a(new AudioContext),l=[{title:"Closed hh",fileName:"hh"},{title:"Opened hh",fileName:"oh"},{title:"Clap",fileName:"cl"},{title:"Snare",fileName:"sd"},{title:"Kick",fileName:"kd"}],o=((e,t)=>{let r={isLoading:!1,isError:!1,data:t??null,error:null};const a=new Set;return{startChange:(...e)=>{r={...r,isLoading:!0,isError:!1,error:null},a.forEach((e=>{e(r)})),(async()=>Promise.all(l.map((({title:e,fileName:t})=>async function(e,t){const r=await fetch(`./${e}`),a=await r.arrayBuffer();return{name:t,audioBuffer:await n.getValue().decodeAudioData(a)}}(`sounds/pack1/${t}.wav`,e)))))(...e).then((e=>{r={isLoading:!1,isError:!1,error:null,data:e},a.forEach((e=>{e(r)}))})).catch((e=>{r={error:e,isError:!0,isLoading:!1,data:t},a.forEach((e=>{e(r)}))}))},subscribe:e=>(a.add(e),()=>{a.delete(e)}),setData:e=>{r=e,a.forEach((e=>{e(r)}))},getValue:()=>r}})(0,[]),s=t=>e.useSyncExternalStore(t.subscribe,t.getValue),i=l.length,c=a(new Array(i).fill(new Array(16).fill(!1))),d=(e,t)=>{c.setData((r=>r.map(((r,a)=>r.map(((r,n)=>a===e&&n===t?!r:r))))))},u=()=>{c.setData((e=>e.map((e=>e.map((()=>!1))))))},f=()=>t.jsx("button",{className:"bg-red-700 rounded text-red-50 py-1 px-4",onClick:u,children:"Clear"}),m=a({rowIndex:0,colIndex:0}),b=(e,t)=>{m.setData({rowIndex:e,colIndex:t})},h=a(0),x=()=>{h.setData((e=>e+1))},g=(e=>{let t=!1;const r=new Set;return{subscribe:e=>(r.add(e),()=>{r.delete(e)}),on:()=>{t=!0,r.forEach((e=>{e(t)}))},off:()=>{t=!1,r.forEach((e=>{e(t)}))},toggle:()=>{t=!t,r.forEach((e=>{e(t)}))},getValue:()=>t}})(),p=t=>e.useSyncExternalStore(t.subscribe,t.getValue),v=()=>{const e=s(c),r=s(m),a=p(g),n=s(h);return t.jsx("div",{className:"bg-blue-50 p-1",onKeyDown:e=>{(e=>{var t,r,a,n;const{rowIndex:l,colIndex:o}=m.getValue(),s=c.getValue();switch(e){case"Enter":d(l,o);break;case"ArrowLeft":void 0!==(null==(t=s[l])?void 0:t[o-1])&&b(l,o-1);break;case"ArrowDown":void 0!==(null==(r=s[l+1])?void 0:r[o])&&b(l+1,o);break;case"ArrowRight":void 0!==(null==(a=s[l])?void 0:a[o+1])&&b(l,o+1);break;case"ArrowUp":void 0!==(null==(n=s[l-1])?void 0:n[o])&&b(l-1,o)}})(e.code)},children:e.map(((l,o)=>t.jsx("div",{className:"flex gap-1 outline-none",tabIndex:1,children:l.map(((l,s)=>t.jsx("div",{onClick:()=>{var e,t;d(e=o,t=s),b(e,t)},className:`mb-1 w-12 h-8 cursor-pointer rounded ${r.rowIndex===o&&r.colIndex===s?"border-8 border-blue-700":""} ${l?"bg-blue-500":s%4==0?"bg-blue-200":"bg-blue-100"} ${a&&n%e[0].length===s?"opacity-50":""} hover:opacity-70`},`${o}-${s}`)))},o)))})},w=a({bpm:120,ms:125});let y=null;const j=()=>{const e=o.getValue().data,t=h.getValue(),r=c.getValue();r.forEach(((a,l)=>{a.forEach(((a,o)=>{a&&t%r[0].length===o&&e&&(e=>{const t=n.getValue(),r=t.createBufferSource();r.buffer=e;const a=t.createGain();r.connect(a),a.connect(t.destination),r.playbackRate.value=2,r.start()})(e[l].audioBuffer)}))}))},E=()=>{g.on(),y=setInterval((()=>{j(),x()}),w.getValue().ms)},N=()=>{g.off(),clearInterval(y),h.setData(0),y=null};let I=Date.now();const V=()=>{const e=Date.now();var t;t=e-I,w.setData({bpm:Math.floor(6e4/t),ms:Math.floor(t/4)}),I=e,g.getValue()&&(clearInterval(y),y=setInterval((()=>{j(),x()}),w.getValue().ms))};w.subscribe((e=>{g.getValue()&&(clearInterval(y),y=setInterval((()=>{j(),x()}),e.ms))}));const k=()=>{const e=p(g);return t.jsx("button",{className:"bg-green-700 rounded text-green-50 py-1 px-4",onClick:e?N:E,children:e?"Stop":"Play"})},D=()=>{const e=s(w).bpm;return t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"mr-2 text-blue-500",children:"BPM:"}),t.jsx("input",{className:"w-16 text-center text-blue-600 outline-blue-500",min:20,max:240,type:"number",value:e,onChange:e=>{var t;t=+e.target.value,w.setData({bpm:t,ms:Math.floor(15e3/t)})}}),t.jsx("button",{className:"ml-4 border border-blue-500 rounded text-blue-500 px-2 py-1 hover:bg-blue-100",onClick:V,children:"TAP"})]})};r.createRoot(document.getElementById("root")).render(t.jsx((()=>{const r=(i=o,e.useSyncExternalStore(i.subscribe,i.getValue)),{data:a,isLoading:n,isError:l,error:s}=r;var i;return e.useEffect((()=>{o.startChange()}),[]),n?t.jsx("h1",{children:"Loading"}):l?t.jsx("h1",{children:"Error"}):t.jsxs("div",{className:"max-w-7xl w-fit mx-auto montserrat p-2",children:[t.jsxs("div",{className:"flex justify-between p-1 text-xl",children:[t.jsx(k,{}),t.jsx(D,{}),t.jsx(f,{})]}),t.jsxs("div",{className:"flex g-2",children:[t.jsx("div",{className:"p-1",children:null==a?void 0:a.map((e=>t.jsx("div",{className:"mb-1 w-32 px-2 w-20 h-8 leading-8 bg-blue-500 text-blue-50 overflow-ellipsis overflow-hidden",children:e.name},e.name)))}),t.jsx(v,{})]})]})}),{}));
//# sourceMappingURL=index-13c78c3a.js.map
