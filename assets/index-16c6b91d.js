import{r as e,j as t,c as r}from"./vendor-36ba57f3.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const a=e=>{let t=e;const r=new Set;return{subscribe:e=>(r.add(e),()=>{r.delete(e)}),setData:e=>{t="function"==typeof e?e(t):e,r.forEach((e=>{e(t)}))},getValue:()=>t}},n=a(new AudioContext),o=[{title:"Closed hh",fileName:"hh"},{title:"Opened hh",fileName:"oh"},{title:"Clap",fileName:"cl"},{title:"Snare",fileName:"sd"},{title:"Kick",fileName:"kd"}],l=((e,t)=>{let r={isLoading:!1,isError:!1,data:t??null,error:null};const a=new Set;return{startChange:(...e)=>{r={...r,isLoading:!0,isError:!1,error:null},a.forEach((e=>{e(r)})),(async()=>Promise.all(o.map((({title:e,fileName:t})=>async function(e,t){const r=await fetch(`./${e}`),a=await r.arrayBuffer();return{name:t,audioBuffer:await n.getValue().decodeAudioData(a)}}(`sounds/pack1/${t}.wav`,e)))))(...e).then((e=>{r={isLoading:!1,isError:!1,error:null,data:e},a.forEach((e=>{e(r)}))})).catch((e=>{r={error:e,isError:!0,isLoading:!1,data:t},a.forEach((e=>{e(r)}))}))},subscribe:e=>(a.add(e),()=>{a.delete(e)}),setData:e=>{r=e,a.forEach((e=>{e(r)}))},getValue:()=>r}})(0,[]),s=t=>e.useSyncExternalStore(t.subscribe,t.getValue),i=a(new Array(o.length).fill(new Array(16).fill(!1))),c=(e,t)=>{i.setData((r=>r.map(((r,a)=>r.map(((r,n)=>a===e&&n===t?!r:r))))))},d=()=>{i.setData((e=>e.map((e=>e.map((()=>!1))))))},u=()=>t.jsx("button",{className:"bg-red-700 rounded text-red-50 py-1 px-4",onClick:d,children:"Clear"}),f=a({rowIndex:0,colIndex:0}),m=(e,t)=>{f.setData({rowIndex:e,colIndex:t})},b=a(0),h=()=>{b.setData((e=>e+1))},x=(e=>{let t=!1;const r=new Set;return{subscribe:e=>(r.add(e),()=>{r.delete(e)}),on:()=>{t=!0,r.forEach((e=>{e(t)}))},off:()=>{t=!1,r.forEach((e=>{e(t)}))},toggle:()=>{t=!t,r.forEach((e=>{e(t)}))},getValue:()=>t}})(),g=t=>e.useSyncExternalStore(t.subscribe,t.getValue),p=()=>{const e=s(i),r=s(f),a=g(x),n=s(b);return t.jsx("div",{className:"bg-blue-50 pt-2 pl-2 pr-2 rounded",onKeyDown:e=>{(e=>{var t,r,a,n;const{rowIndex:o,colIndex:l}=f.getValue(),s=i.getValue();switch(e){case"Enter":c(o,l);break;case"ArrowLeft":void 0!==(null==(t=s[o])?void 0:t[l-1])&&m(o,l-1);break;case"ArrowDown":void 0!==(null==(r=s[o+1])?void 0:r[l])&&m(o+1,l);break;case"ArrowRight":void 0!==(null==(a=s[o])?void 0:a[l+1])&&m(o,l+1);break;case"ArrowUp":void 0!==(null==(n=s[o-1])?void 0:n[l])&&m(o-1,l)}})(e.code)},children:e.map(((o,l)=>t.jsx("div",{className:"flex gap-1 outline-none",tabIndex:1,children:o.map(((o,s)=>t.jsx("div",{onClick:()=>{var e,t;c(e=l,t=s),m(e,t)},className:`mb-1 w-12 h-8 cursor-pointer rounded ${r.rowIndex===l&&r.colIndex===s?"border-8 border-blue-700":""} ${o?"bg-blue-500":s%4==0?"bg-blue-200":"bg-blue-100"} ${a&&n%e[0].length===s?"opacity-50":""} hover:opacity-70`},`${l}-${s}`)))},l)))})},v=e=>(e<1?e=1:e>480&&(e=480),e),w=a({bpm:120,ms:125});let y=null;const j=()=>{const e=l.getValue().data,t=b.getValue(),r=i.getValue();r.forEach(((a,o)=>{a.forEach(((a,l)=>{a&&t%r[0].length===l&&e&&(e=>{const t=n.getValue(),r=t.createBufferSource();r.buffer=e;const a=t.createGain();r.connect(a),a.connect(t.destination),r.playbackRate.value=2,r.start()})(e[o].audioBuffer)}))}))},E=()=>{x.on(),y=setInterval((()=>{j(),h()}),w.getValue().ms)},N=()=>{x.off(),clearInterval(y),b.setData(0),y=null};let I=Date.now();const V=()=>{const e=Date.now();(e=>{const t=v(Math.floor(6e4/e));w.setData({bpm:t,ms:Math.floor(15e3/t)})})(e-I),I=e,x.getValue()&&(clearInterval(y),y=setInterval((()=>{j(),h()}),w.getValue().ms))};w.subscribe((e=>{x.getValue()&&(clearInterval(y),y=setInterval((()=>{j(),h()}),e.ms))}));const D=()=>{const e=g(x);return t.jsx("button",{className:"bg-green-700 rounded text-green-50 py-1 px-4",onClick:e?N:E,children:e?"Stop":"Play"})},k=()=>{const e=s(w).bpm;return t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"mr-2 text-blue-500",children:"BPM:"}),t.jsx("input",{className:"w-16 text-center text-blue-600 outline-blue-500",min:1,max:480,type:"number",value:e,onChange:e=>{var t;t=+e.target.value,w.setData({bpm:v(t),ms:Math.floor(15e3/v(t))})}}),t.jsx("button",{className:"ml-4 border border-blue-500 rounded text-blue-500 px-2 py-1 hover:bg-blue-100",onMouseDown:V,children:"TAP"})]})};r.createRoot(document.getElementById("root")).render(t.jsx((()=>{const r=(i=l,e.useSyncExternalStore(i.subscribe,i.getValue)),{data:a,isLoading:n,isError:o,error:s}=r;var i;return e.useEffect((()=>{l.startChange()}),[]),n?t.jsx("h1",{children:"Loading"}):o?t.jsx("h1",{children:"Error"}):t.jsxs("div",{className:"max-w-7xl w-fit mx-auto montserrat p-2",children:[t.jsxs("div",{className:"flex justify-between py-4 px-1 text-xl",children:[t.jsx(D,{}),t.jsx(k,{}),t.jsx(u,{})]}),t.jsxs("div",{className:"flex g-2",children:[t.jsx("div",{className:"p-2",children:null==a?void 0:a.map((e=>t.jsx("div",{className:"mb-1 w-32 px-2 w-20 h-8 leading-8 bg-blue-500 text-blue-50 overflow-ellipsis overflow-hidden",children:e.name},e.name)))}),t.jsx(p,{})]})]})}),{}));
//# sourceMappingURL=index-16c6b91d.js.map
